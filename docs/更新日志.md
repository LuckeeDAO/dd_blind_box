# 更新日志（中文摘要）

本文件记录项目的重要变更。遵循语义化版本（SemVer）与 Keep a Changelog 格式。未发布（Unreleased）部分用于收集即将发布的改动。

- **新增**：NFT合约实例化功能、外部NFT合约集成、批量铸造支持、权限控制机制
- **变更**：移除本地NFT存储、改为使用外部NFT合约、更新配置结构
- **修复**：测试环境兼容性、地址验证问题、集成测试修复

详细条目见下方英文日志。

# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added
- **NFT Contract Instantiation**: Blind box contract can now instantiate NFT contracts
- **External NFT Integration**: Complete integration with luckee_nft contract
- **Batch Minting Support**: Efficient batch minting through external NFT contract
- **Permission Control**: Only blind box contract can instantiate NFT contracts
- **Reply Handler**: Automatic NFT contract address saving after instantiation
- **New Execute Messages**: `SetNftCodeId`, `InstantiateNftContract`, `SetNftContract`
- **Configuration Updates**: Added `nft_contract` and `nft_code_id` fields to Config
- **Comprehensive Documentation**: Updated all documentation to reflect new features

### Changed
- **Storage Architecture**: Removed local NFT storage, now uses external NFT contract
- **Minting Process**: NFT minting now handled by external contract via BatchMint
- **Query Behavior**: NFT queries now redirect users to query NFT contract directly
- **Test Environment**: Updated tests to work with external NFT contract integration
- **Deployment Process**: Added NFT contract deployment and configuration steps

### Fixed
- **Address Validation**: Fixed address validation issues in test environment
- **Integration Tests**: Updated integration tests to work with new architecture
- **Test Compatibility**: Fixed test failures due to NFT contract dependency
- **Documentation Accuracy**: Updated all documentation to match current implementation

## [0.1.0] - 2024-01-XX

### Added
- Initial release of DD Blind Box contract
- Multi-scale NFT collection support (Tiny to Huge)
- Commit-reveal voting system
- Three-tier reward distribution
- CW721 NFT standard compliance
- Comprehensive access control
- Pause mechanism for emergency situations
- Time window validation for voting phases
- Secure random number generation
- Complete test coverage

### Features
- **Blind Box System**: Sequential NFT minting with overflow protection
- **Voting Mechanism**: Secure commit-reveal scheme with cryptographic commitments
- **Reward Distribution**: Fair three-tier system with secure random selection
- **Security**: Reentrancy protection, DoS prevention, and comprehensive input validation
- **Standards Compliance**: Full CW721 NFT standard implementation
- **Administrative Controls**: Owner-only functions with pause capability

### Security
- Fixed all identified security vulnerabilities
- Implemented comprehensive access control
- Added reentrancy protection
- Enhanced input validation and bounds checking
- Protected against DoS attacks with voter limits
- Secured random number generation with multiple entropy sources

### Testing
- 112 comprehensive tests covering all functionality
- Unit tests for individual functions
- Integration tests for complete workflows
- Error boundary tests for edge cases
- Security tests for access control and validation
