# API 使用示例

以下示例以 `CONTRACT` 为合约地址，`KEY` 为本地 key 名称，`RPC` 为节点 RPC。

## Instantiate
```
INSTANTIATE_MSG='{"scale":"Medium","base":{"denom":"untrn","amount":"100"},"first_prize_count":3}'
neutrond tx wasm instantiate CODE_ID "$INSTANTIATE_MSG" \
  --from KEY --keyring-backend test \
  --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn \
  --gas auto --yes --label dd_blind_box_$(date +%s)
```

## Execute
- **设置NFT合约代码ID**：
```
neutrond tx wasm execute CONTRACT '{"set_nft_code_id":{"code_id":123}}' \
  --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
```
- **实例化NFT合约**：
```
neutrond tx wasm execute CONTRACT '{"instantiate_nft_contract":{"name":"MyBlindBoxNFT","symbol":"MBN","base_uri":"https://example.com/metadata/"}}' \
  --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
```
- **手动设置NFT合约地址**（可选）：
```
neutrond tx wasm execute CONTRACT '{"set_nft_contract":{"nft_contract":"cosmos1..."}}' \
  --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
```
- 设置 base：
```
neutrond tx wasm execute CONTRACT '{"set_base":{"base":{"denom":"untrn","amount":"100"}}}' \
  --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
```
- 设置暂停：
```
neutrond tx wasm execute CONTRACT '{"set_paused":{"paused":true}}' \
  --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
```
- 设置阶段窗口（区块高度或时间，闭区间，按需填写）：
```
neutrond tx wasm execute CONTRACT '{"set_commit_window":{"start_height":null,"end_height":null,"start_time":1700000000,"end_time":1800000000}}' \
  --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes

neutrond tx wasm execute CONTRACT '{"set_reveal_window":{"start_height":null,"end_height":null,"start_time":1800000001,"end_time":1900000000}}' \
  --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes

neutrond tx wasm execute CONTRACT '{"set_closed_window":{"start_height":null,"end_height":null,"start_time":1900000001,"end_time":2000000000}}' \
  --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
```
- **存款领取 NFT**（转账时附带 base denom，通过外部NFT合约批量铸造）：
```
neutrond tx bank send $(neutrond keys show KEY -a --keyring-backend test) CONTRACT 300untrn \
  --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
# 或封装 deposit 执行（本合约在 execute Deposit 中仅读取收到的资金）
neutrond tx wasm execute CONTRACT '{"deposit":{}}' --from KEY \
  --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
```
- 提交承诺：
```
COMMITMENT="$(echo -n "<addr>|<reveal>|<salt>" | sha256sum | cut -d' ' -f1)"
neutrond tx wasm execute CONTRACT '{"commit_vote":{"commitment":"'"$COMMITMENT"'"}}' \
  --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
```
- 揭示：
```
neutrond tx wasm execute CONTRACT '{"reveal_vote":{"reveal":"<reveal>","salt":"<salt>"}}' \
  --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
```
- 切换投票状态：
```
neutrond tx wasm execute CONTRACT '{"set_vote_state":{"state":"Reveal"}}' --from KEY \
  --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
```
- 结算：
```
neutrond tx wasm execute CONTRACT '{"finalize":{}}' --from KEY \
  --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
```
- **CW721 类操作**（通过外部NFT合约执行）：
```
neutrond tx wasm execute CONTRACT '{"transfer_nft":{"recipient":"ADDR","token_id":1}}' --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
neutrond tx wasm execute CONTRACT '{"approve":{"spender":"ADDR","token_id":1}}' --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
neutrond tx wasm execute CONTRACT '{"revoke":{"spender":"ADDR","token_id":1}}' --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
neutrond tx wasm execute CONTRACT '{"approve_all":{"operator":"ADDR"}}' --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
neutrond tx wasm execute CONTRACT '{"revoke_all":{"operator":"ADDR"}}' --from KEY --chain-id CHAIN_ID --node RPC --gas-prices 0.025untrn --gas auto --yes
```

## Query
- **配置**（包含NFT合约地址和代码ID）：
```
neutrond query wasm contract-state smart CONTRACT '{"config":{}}' --node RPC
```
- **本金与分层**：
```
neutrond query wasm contract-state smart CONTRACT '{"deposit_of":{"address":"ADDR"}}' --node RPC
neutrond query wasm contract-state smart CONTRACT '{"tier_of":{"address":"ADDR"}}' --node RPC
```
- **NFT查询**（会提示直接查询NFT合约）：
```
neutrond query wasm contract-state smart CONTRACT '{"owner_of":{"token_id":1}}' --node RPC
neutrond query wasm contract-state smart CONTRACT '{"nft_info":{"token_id":1}}' --node RPC
neutrond query wasm contract-state smart CONTRACT '{"approval":{"token_id":1}}' --node RPC
neutrond query wasm contract-state smart CONTRACT '{"is_approved_for_all":{"owner":"ADDR","operator":"ADDR"}}' --node RPC
neutrond query wasm contract-state smart CONTRACT '{"token_uri":{"token_id":1}}' --node RPC
neutrond query wasm contract-state smart CONTRACT '{"all_tokens":{"start_after":null,"limit":50}}' --node RPC
neutrond query wasm contract-state smart CONTRACT '{"tokens":{"owner":"ADDR","start_after":null,"limit":50}}' --node RPC
```
- **分层分页**：
```
neutrond query wasm contract-state smart CONTRACT '{"tier_list":{"tier":1,"start_after":null,"limit":50}}' --node RPC
```

## NFT合约直接查询
由于NFT功能已迁移到外部合约，建议直接查询NFT合约：
```
# 假设NFT合约地址为 NFT_CONTRACT
neutrond query wasm contract-state smart NFT_CONTRACT '{"owner_of":{"token_id":1}}' --node RPC
neutrond query wasm contract-state smart NFT_CONTRACT '{"nft_info":{"token_id":1}}' --node RPC
neutrond query wasm contract-state smart NFT_CONTRACT '{"tokens":{"owner":"ADDR","start_after":null,"limit":50}}' --node RPC
```
